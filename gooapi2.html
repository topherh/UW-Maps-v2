<html>
<head>
<title>Google Maps:::CSU System Campuses</title>
<script src="http://maps.google.com/maps?file=api&v=1&key=ABQIAAAAcU4W0SxvtACcZE2LNL5tMhR57FxBg2vraljJuCRYJRls82Rc6RTiH39-xgiA4Y9UKZ8M38sSsPmrrw" type="text/javascript"></script>
<link href="../styles/style-default.css" rel="stylesheet" type="text/css">
</head>
<body onLoad="getData();">
<table width="780" border="0">
<tr>
  <td colspan="2"><img src="../graphics/head.jpg" width="780" height="80"></td>
  </tr>
<tr>
  <td class="title">CSU System Campuses</td>

</tr>
<tr>
  <td>Click on an icon to select a campus. A display box will pop up. Click on
    the school name to go to its homepage or type in your starting address if
    you would like directions on how to get there. </td>
</tr>
<tr>
<td>
<div id="map" style="width: 750px; height: 540px">

</div>
</td>
</tr>
</table>
<div id="requests"></div>
<script type="text/javascript">
//<![CDATA[

var map = new GMap(document.getElementById("map"));
map.addControl(new GSmallMapControl());
map.centerAndZoom(new GPoint(47.6465, -122.32565), 8);

var baseIcon = new GIcon();
baseIcon.iconSize = new GSize(20, 34);
baseIcon.iconAnchor = new GPoint(6, 20);
baseIcon.infoWindowAnchor = new GPoint(5, 1);

// Creates a marker whose info window displays the given number
function createMarker(marker_data) 
{
  var lng = parseFloat(marker_data.getAttribute("lng"));
  var lat = parseFloat(marker_data.getAttribute("lat"));
  var address = marker_data.getAttribute("address");
  var href = marker_data.getAttribute("href");
  var name = marker_data.getAttribute("name");
  var image = marker_data.getAttribute("image");
  var height = marker_data.getAttribute("height");
  var weight = marker_data.getAttribute("weight");

  var icon = new GIcon(baseIcon);
  icon.image = marker_data.getAttribute("icon");

  var marker = new GMarker(new GPoint(lng, lat), icon);
  var html = '<a href="' + href + '">' + name + '</a><br />' + 
             '<img src="' + image + '" height="' + height + '" ' + 
                  'weight="' + weight + '" /><br />' + 
             'Enter a starting address: <br />' +
             '<form action="http://maps.google.com/" ' + 
                   'onsubmit="this.q.value=this.from.value + \' to \' + this.to.value;">' + 
             '<input type="text" name="from" /><br />' + 
             '<input type="hidden" name="to" value="' + address + '" />' + 
             '<input type="hidden" name="q" value="" />' + 
             '<input type="submit" value="Get directions to ' + name + '" />' +
             '</form>';
  GEvent.addListener(marker, 
                     "click", 
                     function() { marker.openInfoWindowHtml(html); });
  return marker;
}

function getData()
{
  var bounds = map.getBoundsLatLng();
  var request = GXmlHttp.create();
  var now = new Date();
  var url = "ctschools.xml?var=" + now.getTime();
  document.getElementById("requests").innerHTML = document.getElementById("requests").innerHTML + url + "<br />";
  request.open("GET", url, true);
  request.onreadystatechange = 
  function() 
  {
    if (request.readyState == 4) 
    {
      var xmlDoc = request.responseXML;
      var markers = 
          xmlDoc.documentElement.getElementsByTagName("marker");
      for (var i = 0; i < markers.length; i++) 
      {
        map.addOverlay(createMarker(markers[i]));
      }
    }
  }
  request.send(null);
}

// GEvent.addListener(map, "moveend", getData);

//]]>
</script> 

</body>
</html>
