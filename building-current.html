<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<link href="Slim_Header/header.css" rel="stylesheet" type="text/css" />
<style type="text/css">
    body {
        margin-left: 0px;
        margin-top: 0px;
        margin-right: 0px;
        margin-bottom: 0px;
    }
</style>

<script type="text/javascript">
<!--
function MM_jumpMenu(targ,selObj,restore){ //v3.0
  eval(targ+".location='"+selObj.options[selObj.selectedIndex].value+"'");
  if (restore) selObj.selectedIndex=0;
}
//-->
</script>
<link href="funkyBox.css" rel="stylesheet" type="text/css" />
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>UW - Google Maps JavaScript API Example</title>

    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAcU4W0SxvtACcZE2LNL5tMhQOjAQj1TDVieadEub6KQQllOqtmRQlZxJIcWkImOAv2IHj2_p0dx4emQ" type="text/javascript"></script>
    <script src="http://www.google.com/uds/api?file=uds.js&v=1.0&key=ABQIAAAAcU4W0SxvtACcZE2LNL5tMhQOjAQj1TDVieadEub6KQQllOqtmRQlZxJIcWkImOAv2IHj2_p0dx4emQ" type="text/javascript"></script>      
    <script src="http://www.google.com/uds/solutions/localsearch/gmlocalsearch.js" type="text/javascript"></script>

    <script type="text/javascript" src="scripts/plusminus.js"></script>
        <script type="text/javascript" src="scripts/extinfowindow.js"></script>
    <link href="main.css" rel="stylesheet" type="text/css" />
    
    <style type="text/css">
      @import url("http://www.google.com/uds/css/gsearch.css");
      @import url("http://www.google.com/uds/solutions/localsearch/gmlocalsearch.css");
    </style>

    <script type="text/javascript">
    //<![CDATA[

    google.load('search', '1');
    
    // Our global state
    var gLocalSearch;
    var map;
    var gSelectedResults = [];
    var gCurrentResults = [];
    var gSearchForm;
    
    // Create our "tiny" marker icon 
    var gSmallIcon = new GIcon();
    gSmallIcon.image = "http://labs.google.com/ridefinder/images/mm_20_yellow.png";
    gSmallIcon.shadow = "http://labs.google.com/ridefinder/images/mm_20_shadow.png";
    gSmallIcon.iconSize = new GSize(12, 20);
    gSmallIcon.shadowSize = new GSize(22, 20);
    gSmallIcon.iconAnchor = new GPoint(6, 20);
    gSmallIcon.infoWindowAnchor = new GPoint(5, 1); 
    
    // Create our "tiny" marker icon
    var gmarkers = [];

    // This icon is a different shape, so we need our own settings       
    var buildingIcon = new GIcon();
    buildingIcon.image = "img/flags/H.gif";
    buildingIcon.shadow = "img/shadow.png";
    buildingIcon.iconSize = new GSize(32, 32);
    buildingIcon.shadowSize = new GSize(45, 33);
    buildingIcon.iconAnchor = new GPoint(5, 34);
    buildingIcon.infoWindowAnchor = new GPoint(5, 2);
    buildingIcon.infoShadowAnchor = new GPoint(14, 25);
    buildingIcon.transparent = "img/flags/.gif";
    buildingIcon.printImage = "img/flags/.gif";
    buildingIcon.mozPrintImage = "img/flags/.gif";

    // An array of GIcons, to make the selection easier
    var gicons = [];
    gicons["building"] = buildingIcon;

    // A function to create the marker and set up the event window
    function createMarker(point,name,html,category)
    {
        var marker = new GMarker(point,gicons[category]);
        // === Store the category and name info as a marker properties ===
        marker.mycategory = category;                                 
        marker.myname = name;
        GEvent.addListener(marker, "click", function()
        {
            marker.openExtInfoWindow(
              map,
              "extInfoWindow_funkyBox", html,
              {beakOffset: 2}
            ); 
        });
        gmarkers.push(marker);
        return marker;
    }

    function OnLoad()
    {
        if (GBrowserIsCompatible())
        {
            // create the map
            map = new GMap2(document.getElementById("map"));

            var boundaries = new GLatLngBounds(new GLatLng(47.6465,-122.32565), new GLatLng(47.6641,-122.2881));
            var oldmap = new GGroundOverlay("http://depts.washington.edu/uweb/map/map4.gif", boundaries);            
            // ground overlay
            map.addOverlay(oldmap);
                        
            ////////////////////////////////////////////// SEARCH //////////////////////////////////////////////
            // // // var options = new google.search.SearcherOptions(); 
            // // // options.setExpandMode(GSearchControl.EXPAND_MODE_OPEN);

            // // // var searchControl = new google.search.SearchControl();
            // // // searchControl.setSearchCompleteCallback(this, gotResults);

            // // // var localSearch = new google.search.LocalSearch();
            // // // searchControl.addSearcher(localSearch, options);

            // // // localSearch.setCenterPoint(new GLatLng(47.65565,-122.30817), 17);
            // // // searchControl.draw(document.getElementById("search"));
            ////////////////////////////////////////////// SEARCH //////////////////////////////////////////////
            
            gLocalSearch = new GlocalSearch();
            gLocalSearch.setSearchCompleteCallback(null, OnLocalSearch);

            map.addControl(new GLargeMapControl());
            map.addControl(new GMapTypeControl());
            
            map.setCenter(new GLatLng(47.65565,-122.30817), 17);
            
            // Read the data
            GDownloadUrl("categories.xml", function(doc)
            {
                var xmlDoc = GXml.parse(doc);
                var markers = xmlDoc.documentElement.getElementsByTagName("marker");

                for (var i = 0; i < markers.length; i++)
                {
                    // obtain the attribues of each marker
                    var lat = parseFloat(markers[i].getAttribute("lat"));
                    var lng = parseFloat(markers[i].getAttribute("lng"));
                    var point = new GLatLng(lat,lng);
                    var address = markers[i].getAttribute("address");
                    var name = markers[i].getAttribute("name");
                    var html = "<b>"+name+"</b><p>"+address;
                    var category = markers[i].getAttribute("category");
                    // create the marker
                    var marker = createMarker(point,name,html,category);
                    map.addOverlay(marker);
                    //GLog.write(marker);
                }
                
                // == show or hide the categories initially ==
                hide("emergency");
                hide("parking");		
                hide("bus");
                hide("emergency");
                hide("atm");
                hide("libraries");
                hide("zip");	
                hide("wifi");
                hide("bike");
                show("building");
            });
            
        }
        else
        {
            alert("Sorry, the Google Maps API is not compatible with this browser");
        }

    }
    
    function gotResults(sc, searcher)
	{
		var resultcontent = '';
		var resultdiv = document.getElementById('searchresults');
		
		for (i=0; i<searcher.results.length; i++)
		{
			var result = searcher.results[i];
			resultcontent += '<p>'+result.title+'<br />'+result.streetAddress+'</p>';
		}
		resultdiv.innerHTML = resultcontent;
	}
    
    // doSearch needs to work with OnLocalSearch to do the actual searching
    // then display the correct results on screen
    function doSearch()
    {
        var zip = document.getElementById("zipInput").value;
        var cat = document.getElementById("catInput").value;
        gLocalSearch.setCenterPoint(zip);
        gLocalSearch.execute(cat);
    } 

    // Called when Local Search results are returned, we clear the old
    // results and load the new ones.
    function OnLocalSearch()
    {
        if (!gLocalSearch.results) return;
        var searchWell = document.getElementById("searchwell");

        // Clear the map and the old search well
        searchWell.innerHTML = "";
        for (var i = 0; i < gCurrentResults.length; i++)
        {
            if (!gCurrentResults[i].selected())
            {
                map.removeOverlay(gCurrentResults[i].marker());
            }
        }

        gCurrentResults = [];
        for (var i = 0; i < gLocalSearch.results.length; i++)
        {
            gCurrentResults.push(new LocalResult(gLocalSearch.results[i]));
        }

        var attribution = gLocalSearch.getAttribution();
        if (attribution)
        {
            document.getElementById("searchwell").appendChild(attribution);
        }
    
        // move the map to the first result
        var first = gLocalSearch.results[0];
        map.panTo(new GLatLng(first.lat, first.lng));
    }

    // Cancel the form submission, executing an AJAX Search API search.
    function CaptureForm(searchForm)
    {
        gLocalSearch.execute(searchForm.input.value);
        return false;
    }

    // A class representing a single Local Search result returned by the
    // Google AJAX Search API.
    function LocalResult(result)
    {
        this.result_ = result;
        this.resultNode_ = this.unselectedHtml();
        document.getElementById("searchwell").appendChild(this.resultNode_);
        map.addOverlay(this.marker(gSmallIcon));
    }

    // Returns the map marker for this result, creating it with the given
    // icon if it has not already been created.
    LocalResult.prototype.marker = function(opt_icon)
    {
        if (this.marker_) return this.marker_;
        var marker = new google.maps.Marker(
            new GLatLng(parseFloat(this.result_.lat),
            parseFloat(this.result_.lng)),
            opt_icon);
            
            GEvent.bind(marker, "click", this, function()
            {
                marker.openInfoWindow(this.selected() ? this.selectedHtml() : this.unselectedHtml());
            });

        this.marker_ = marker;
        return marker;
    }

    // "Saves" this result if it has not already been saved
    LocalResult.prototype.select = function()
    {
        if (!this.selected())
        {
            this.selected_ = true;

            // Remove the old marker and add the new marker
            map.removeOverlay(this.marker());
            this.marker_ = null;
            map.addOverlay(this.marker(G_DEFAULT_ICON));

            // Add our result to the saved set
            document.getElementById("selected").appendChild(this.selectedHtml());

            // Remove the old search result from the search well
            this.resultNode_.parentNode.removeChild(this.resultNode_);
        }
    }

    // Returns the HTML we display for a result before it has been "saved"
    LocalResult.prototype.unselectedHtml = function()
    {
        var container = document.createElement("div");
        container.className = "unselected";
        container.appendChild(this.result_.html.cloneNode(true));
        
        var saveDiv = document.createElement("div");
        saveDiv.className = "select";
        saveDiv.innerHTML = "Save this location";
        GEvent.bindDom(saveDiv, "click", this, function()
        {
            map.closeInfoWindow();
            this.select();
            gSelectedResults.push(this);
        });
        container.appendChild(saveDiv);
        return container;
    }

    // Returns the HTML we display for a result after it has been "saved"
    LocalResult.prototype.selectedHtml = function()
    {
        return this.result_.html.cloneNode(true);
    }

    // Returns true if this result is currently "saved"
    LocalResult.prototype.selected = function()
    {
        return this.selected_;
    }
    
    google.setOnLoadCallback(OnLoad);    

    // == shows all markers of a particular category, and ensures the checkbox is checked ==
    function show(category)
    {
        for (var i=0; i<gmarkers.length; i++)
        {
            if (gmarkers[i].mycategory == category)
            {
                gmarkers[i].show();
            }
        }
        // == check the checkbox ==
        document.getElementById(category+"box").checked = true;
    }

    // == hides all markers of a particular category, and ensures the checkbox is cleared ==
    function hide(category)
    {
        for (var i=0; i<gmarkers.length; i++)
        {
            if (gmarkers[i].mycategory == category)
            {
                gmarkers[i].hide();
            }
        }
        // == clear the checkbox ==
        document.getElementById(category+"box").checked = false;
        // == close the info window, in case its open on a marker that we just hid
        map.closeInfoWindow();
    }

    // == a checkbox has been clicked ==
    function boxclick(box,category)
    {
        if (box.checked)
        {
            show(category);
        }
        else
        {
            hide(category);
        }
    }

    function myclick(i)
    {
        GEvent.trigger(gmarkers[i],"click");
    }
    //]]>
</script>

    <script>
    window.onload = function() {
         menuinit();
    }
    window.onunload = function()
    {
        GUnload();
    }
    </script>


</head>
  <body>
  
  <div id="thinSearchbar">
	<a href="http://www.washington.edu/"><img id="lgo" src="Slim_Header/w.gif" alt="University of Washington"/></a>  
<div id="rhtlnks">
      <form class=formation name=form1 id="searchbox_001967960132951597331:04hcho0_drk" 
			action="http://www.google.com/cse">
        <input type="hidden" name="cx" value="001967960132951597331:04hcho0_drk" />
        <input type="hidden" name="cof" value="FORID:0" />
        <input name="q" type="text" size="20" value="Enter Search" onClick="make_blank();"/>
        <input type="submit" name="sa" value="Go" />
      </form>
      <div id="searcha">
        <ul>
          <li><a href="http://www.washington.edu/discovery/about.html">About Us</a>&nbsp;&nbsp;<span class="barLeft">|</span></li>
          <li><a href="http://www.uwnews.org/">News</a>&nbsp;&nbsp;<span class="barLeft">|</span></li>
          <li><a href="http://gohuskies.ocsn.com/">Sports</a>&nbsp;&nbsp;<span class="barLeft">|</span></li>
          <li><a href="http://www.washington.edu/alumni/">Alumni</a>&nbsp;&nbsp;<span class="barLeft">|</span></li>
          <li><a href="http://myuw.washington.edu/">MyUW</a>&nbsp;&nbsp;<span class="barLeft">|</span></li>
          <li><a href="http://www.washington.edu/home/directories.html">Directories</a>&nbsp;&nbsp;<span class="barLeft">|</span></li>
          <li><a href="http://www.washington.edu/visit/events.html">Calendar</a></li>
        </ul>
      </div>
    </div>

  </div>
  
        <div id="entire">

      <div id="nav"><br />
	      
    <div id="search">
        <div id="searchform">
            <input type="text" id="zipInput" />
            <select id="catInput">
                <option value="restaurants">Restaurants</option>
                <option value="bars">Bars</option>
            </select>
            <input type="button" value="Find" onclick="doSearch()"/>
        </div>
    </div>
        
    <div id="or"> -- or -- </div>
         
	<select name="buildingList" size="1" class="gmls-no-results-label" id="parkingbox" onclick="boxclick(this,'parking')">
	  <option selected="selected">Select a building...</option>
	  <option>Academic Computer Center</option>
	  <option>Aerodynamics Lab</option>
	  <option>Allen Library </option>
	  <option>Alumni House</option>
	  <option>Anderson Hall</option>
	  <option>Architecture Hall</option>
	  <option>Art Bldg</option>
	  <option>Arts Ticket Office</option>
	  <option>Atmos Sciences - Geophysics</option>
	  <option>Bagley Hall </option>
	  <option id="parking" onclick="show(this)">Balmer Hall</option>
	  <option>Bank of America Exec Ed Ctr</option>
	</select>

      
  <br />
  <br />

  	  <div id="dotted">
	      <ul>
	        <li>
	          <a id="fParking" class="forms" href="#" onclick="menuexpand('m1'); return false;"><label><input class="checky" type="checkbox" id="parkingbox" onclick="boxclick(this,'parking')" /></label>Parking<img id="pm1" src="" alt=""></a>
	          <ul id="m1">
	            <li><form method="post" action="" class="subforms"><p>
	              <label><input type="checkbox" id="bus" /></label>
	              Motorcycle parking lots</p></form>
                </li>
                                       
                   <li><form method="post" action="" class="subforms"><p>
                       <label><input type="checkbox" id="bus" /></label>
                        Unrestricted parking lots</p></form>
				  </li>
                              
                  <li><form method="post" action="" class="subforms"><p>
                       <label><input type="checkbox" id="bus" /></label>Campus gatehouses</p>
     							   </form>
				  </li><br />
              </ul>
            </li>
                    
                  
            <li>
              <a id="fBus" class="forms" href="#" onclick="menuexpand('m2'); return false;"><label><input class="checky" type="checkbox" id="busbox" onclick="busclick(this,'bus')" /></label>Bus Stops<img id="pm2" src="" alt=""></a>
                    <ul id="m2">
                        <li><form method="post" action="" class="subforms"><p>
                          <label><input type="checkbox" id="bus" /></label>
                          Sound Transit</p></form>
                        </li>
                                       
                        <li><form method="post" action="" class="subforms"><p>
                             <label><input type="checkbox" id="bus" /></label>
                              Metro</p></form>
   					    </li><br />                        
                   </ul>
            </li>      
            
            <li>
					<a id="fEmergency" class="forms" href="#"><label><input class="checky" type="checkbox" id="emergencybox" onclick="boxclick(this,'emergency')" /></label>Emergency Phone</a>
            </li>   
            
            <li>
              <a id="fATM" class="forms" href="#"><label><input class="checky" type="checkbox" id="atmbox" onclick="boxclick(this,'atm')" /></label>ATM</a>
            </li>  
            
            <li>
              <a id="fLibraries" class="forms" href="#"><label><input class="checky" type="checkbox" id="librariesbox" onclick="boxclick(this,'libraries')" /></label>Libraries</a>
            </li>  
            
            <li>
				<a id="fBuilding" class="forms" href="#"><label><input class="checky" type="checkbox" id="buildingbox" onclick="boxclick(this,'building')" /></label>Buildings</a>
            </li>   
            
            <li>
              <a id="fZip" class="forms" href="#"><label><input class="checky" type="checkbox" id="zipbox" onclick="boxclick(this,'zip')" /></label>Zip Cars</a>
            </li>  
            
            <li>
              <a id="fWi" class="forms" href="#"><label><input class="checky" type="checkbox" id="wifibox" onclick="boxclick(this,'wifi')" /></label>Wi-Fi Hotspots</a>
            </li>     
              
            <li>
              <a id="fBike" class="forms" href="#"><label><input class="checky" type="checkbox" id="bikebox" onclick="boxclick(this,'bike')" /></label>Bike Racks</a>
            </li>   
	    </ul>

          
        <br />
        </div>
    <div id="results">
        <div id="searchwell" style="overflow:auto; height:180px;"></div>
    </div>

<div id="selected"></div>
        </div>
      
<div id="map"></div>
</div>

      
</body>
</html>